:root {
  --bg: #f6f5f2;
  --surface: #ffffff;
  --panel: #ffffff;
  --text: #0f172a;
  --muted: #6b7280;
  --primary: #2f81f7;
  --danger: #f85149;
  --border: #e5e7eb;
  --accent: #eaf2ff;
}

* { box-sizing: border-box; }
html, body, #root { height: 100%; }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background: var(--bg);
  color: var(--text);
  font-size: 18px;
}

.container {
  min-height: 100%;
  display: grid;
  grid-template-rows: auto 1fr auto;
}

.slider { width: 220px; }

.chat {
  max-width: 820px;
  width: 100%;
  margin: 0 auto;
  padding: 20px 16px 140px;
}

.hero {
  min-height: calc(100vh - 140px);
  display: grid;
  place-items: center;
}

.app-title {
  max-width: 820px;
  margin: 40px auto 8px;
  padding: 0 16px;
  font-weight: 700;
  font-size: 40px;
  text-align: center;
}

.icon-button {
  display: inline-flex; align-items: center; justify-content: center;
  width: 40px; height: 40px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text);
  box-shadow: 0 1px 2px rgba(15,23,42,0.05);
  padding: 0;
  line-height: 0;
}
.icon-button svg { display: block; }
.icon-button:hover { border-color: #d1d5db; }
.actions { position: relative; display: grid; align-items: center; }
.settings-panel {
  position: absolute;
  right: 0; top: auto; bottom: calc(100% + 10px);
  width: 360px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 12px 24px rgba(15,23,42,0.08);
  z-index: 20;
}
.settings-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.settings-label { color: var(--muted); }
.settings-value { font-variant-numeric: tabular-nums; }

.message { display: flex; margin: 12px 0; }
.message.user { justify-content: flex-end; }
.message.assistant { justify-content: flex-start; }
.message.system { justify-content: center; }

.bubble {
  max-width: 85%;
  padding: 18px 20px;
  border-radius: 18px;
  border: 1px solid var(--border);
  background: var(--panel);
  box-shadow: 0 1px 2px rgba(15,23,42,0.04), 0 6px 16px rgba(15,23,42,0.06);
}
.message.user .bubble { background: var(--accent); border-color: #dbe8ff; }
.message.system .bubble { background: #fff; border-style: dashed; color: var(--muted); }
.bubble.error { border-color: var(--danger); color: #9a1b19; background: #fff1f0; }
.message.system .bubble.thinking { position: relative; color: var(--muted); }
.message.system .bubble.thinking::after {
  content: ' '; display: inline-block; width: 1.2em; text-align: left; margin-left: 4px;
  animation: dots 1.4s steps(3, end) infinite;
}
@keyframes dots {
  0%, 20% { content: ''; }
  40% { content: '.'; }
  60% { content: '..'; }
  80%, 100% { content: '...'; }
}

.prose :is(p, ul, ol) { margin: 10px 0; }
.prose pre, .prose code { white-space: pre-wrap; word-wrap: break-word; }
.prose ul { padding-left: 20px; }
.prose h1, .prose h2, .prose h3 { margin: 12px 0 6px; }

.citations { margin-top: 10px; padding-left: 16px; }
.citations a { color: var(--primary); text-decoration: none; }
.citations a:hover { text-decoration: underline; }

.composer {
  position: sticky; bottom: 16px; left: 0; right: 0;
  border-top: none;
  background: transparent;
  backdrop-filter: none;
}
.composer-row {
  max-width: 820px; margin: 0 auto; padding: 14px 16px;
  display: flex; gap: 10px; align-items: center;
  background: var(--panel);
  border: 1px solid #cdd3de;
  border-radius: 18px;
  box-shadow: 0 6px 24px rgba(15,23,42,0.08);
}
.composer-row textarea {
  flex: 1;
  background: transparent;
  border: none;
  border-radius: 14px;
  padding: 16px 18px;
  color: var(--text);
  resize: none;
  min-height: 68px;
  max-height: 260px;
  line-height: 1.4;
}
.composer-row textarea:focus { outline: none; }

.composer-row.large { max-width: 820px; width: 100%; box-shadow: 0 10px 32px rgba(15,23,42,0.10); }

button {
  background: var(--primary);
  border: none;
  color: white;
  border-radius: 14px;
  padding: 14px 18px;
  cursor: pointer;
}
button:disabled { opacity: 0.6; cursor: not-allowed; }

.muted { color: var(--muted); }
.small { font-size: 12px; }

.msg-actions { position: absolute; top: 8px; right: 8px; display: flex; gap: 6px; }
.msg-action-btn {
  width: 28px; height: 28px;
  display: inline-flex; align-items: center; justify-content: center;
  background: #f6f7fb; border: 1px solid #e5e7eb; border-radius: 8px; color: #374151;
}
.msg-action-btn:hover { background: #eef0f6; }
.bubble { position: relative; }

.msg-toolbar {
  display: flex; gap: 12px; align-items: center;
  margin: 6px 0 2px 6px;
}
.message.user .msg-toolbar { justify-content: flex-end; margin: 6px 6px 2px 0; }
.msg-toolbar button { border: none; background: transparent; color: #374151; display: inline-flex; align-items: center; gap: 6px; cursor: pointer; padding: 4px 6px; border-radius: 8px; }
.msg-toolbar button:hover { background: #f3f4f6; }
.msg-toolbar .edit { visibility: hidden; }
.message.user:hover .msg-toolbar .edit,
.message.user .bubble:hover + .msg-toolbar .edit,
.message.user + .msg-toolbar:hover .edit { visibility: visible; }

.inline-editor textarea {
  width: 100%; min-height: 68px; resize: vertical;
  background: #fff; color: var(--text);
  border: 1px solid #d0d5dd; border-radius: 14px; padding: 16px 18px;
}
.editor-actions { display: flex; gap: 8px; margin-top: 8px; }
.ghost-btn { background: transparent; color: #374151; border: 1px solid #e5e7eb; }
.ghost-btn:hover { background: #f3f4f6; }

/* Prevent copying of user messages and keep bubble size when editing */
.uncopyable, .uncopyable * { user-select: none; -webkit-user-select: none; -ms-user-select: none; -webkit-touch-callout: none; }
.message.user .bubble { min-height: 68px; }

/* Inline editor inside bubble (new classes) */
.editor { display: flex; flex-direction: column; gap: 10px; }
.editor-text { width: 100%; background: transparent; color: var(--text); border: 1px solid #d0d5dd; border-radius: 14px; padding: 16px 18px; min-height: 68px; resize: vertical; }

/* Edit pill near user bubble */
.edit-pill {
  position: absolute; right: -10px; top: 50%; transform: translateY(-50%);
  background: #fff; color: #111827; border: 1px solid #e5e7eb; border-radius: 10px;
  padding: 6px 10px; font-size: 14px; box-shadow: 0 2px 8px rgba(15,23,42,0.1);
  opacity: 0; pointer-events: none; transition: opacity .15s ease;
}
.message.user .bubble:hover .edit-pill { opacity: 1; pointer-events: auto; }

/* Preserve bubble size when editing */
.message.user .bubble { position: relative; }

/* Autosize textareas: ensure no scrollbars appear while growing */
.composer-row textarea { overflow: hidden; }
.inline-editor textarea { overflow: hidden; resize: none; }
.editor-text { overflow: hidden; resize: none; }

/* Nicer range slider */
.slider {
  -webkit-appearance: none; appearance: none;
  width: 100%; height: 6px; background: #e5e7eb; border-radius: 999px; outline: none;
}
.slider:disabled { opacity: 0.5; }
.slider::-webkit-slider-thumb {
  -webkit-appearance: none; appearance: none; width: 18px; height: 18px;
  background: var(--primary); border-radius: 50%; border: 2px solid #fff;
  box-shadow: 0 2px 6px rgba(15,23,42,0.18);
}
.slider::-moz-range-thumb {
  width: 18px; height: 18px; background: var(--primary); border-radius: 50%; border: 2px solid #fff;
  box-shadow: 0 2px 6px rgba(15,23,42,0.18);
}

/* Toggle switch like screenshot */
.switch { position: relative; display: inline-flex; width: 46px; height: 26px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider-switch {
  position: absolute; cursor: pointer; inset: 0; background: #e5e7eb; border: 1px solid #d1d5db; border-radius: 999px; transition: background-color .2s, border-color .2s;
}
.slider-switch::before {
  content: ""; position: absolute; height: 22px; width: 22px; left: 2px; top: 50%; transform: translateY(-50%);
  background: #fff; border-radius: 50%; box-shadow: 0 2px 8px rgba(15,23,42,0.18);
  transition: transform .2s;
}
.switch input:checked + .slider-switch { background: var(--primary); border-color: var(--primary); }
.switch input:checked + .slider-switch::before { transform: translate(20px, -50%); }

/* Edit button safe area: bottom-right on bubble edge */
.edit-pill { right: 8px; bottom: -10px; top: auto; transform: none; }
.message.user .bubble:hover .edit-pill { opacity: 1; }

/* Ensure bubble has a bit of space but not too much */
.message.user .bubble { padding-bottom: 20px; }
